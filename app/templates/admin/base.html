{% extends "base.html" %}

{% block extra_css %}
<style>
    .sidebar {
        min-height: 100vh;
        background: linear-gradient(180deg, #1a1a2e 0%, #16213e 100%);
        width: 260px;
        overflow-y: auto;
    }

    .sidebar .nav-link {
        color: rgba(255, 255, 255, 0.8);
        padding: 10px 16px;
        border-radius: 8px;
        margin: 2px 8px;
        transition: all 0.3s;
        font-size: 0.9rem;
    }

    .sidebar .nav-link:hover {
        background: rgba(255, 255, 255, 0.1);
        color: #fff;
    }

    .sidebar .nav-link.active {
        background: var(--primary-color);
        color: #fff;
    }

    .sidebar .nav-link i {
        width: 22px;
    }

    /* ── Grupos colapsáveis ── */
    .nav-group-toggle {
        display: flex;
        align-items: center;
        cursor: pointer;
        font-weight: 600;
        font-size: 0.82rem;
        text-transform: uppercase;
        letter-spacing: 0.4px;
        color: rgba(255,255,255,0.55) !important;
        padding: 8px 16px !important;
        margin-top: 6px;
    }
    .nav-group-toggle:hover {
        color: rgba(255,255,255,0.9) !important;
        background: transparent !important;
    }
    .nav-group-toggle .nav-arrow {
        margin-left: auto;
        font-size: 0.6rem;
        transition: transform 0.25s ease;
    }
    .nav-group-toggle[aria-expanded="true"] .nav-arrow,
    .nav-group-toggle.open .nav-arrow {
        transform: rotate(90deg);
    }
    .nav-sub {
        padding: 0 0 4px 0;
    }
    .nav-sub .nav-link {
        padding: 7px 16px 7px 38px !important;
        font-size: 0.85rem;
    }

    .main-content {
        background-color: #f8f9fa;
        min-height: 100vh;
    }

    .card {
        border: none;
        box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
        border-radius: 12px;
    }

    .card-header {
        background-color: #fff;
        border-bottom: 1px solid #eee;
        font-weight: 600;
    }

    .stat-card { border-left: 4px solid var(--primary-color); }
    .stat-card.success { border-left-color: #28a745; }
    .stat-card.warning { border-left-color: #ffc107; }
    .stat-card.danger { border-left-color: #dc3545; }
    .stat-card.info { border-left-color: #17a2b8; }

    .table th {
        font-weight: 600;
        background-color: #f8f9fa;
    }

    .badge-status {
        padding: 6px 12px;
        border-radius: 20px;
        font-weight: 500;
    }

    /* Mobile: sidebar escondida, offcanvas */
    @media (max-width: 991.98px) {
        .sidebar-desktop { display: none !important; }
        .main-content { min-height: auto; }
        .mobile-topbar { display: flex !important; }
    }
    @media (min-width: 992px) {
        .mobile-topbar { display: none !important; }
    }

    /* Offcanvas com mesmo estilo */
    .offcanvas-admin {
        background: linear-gradient(180deg, #1a1a2e 0%, #16213e 100%);
        width: 280px !important;
    }
    .offcanvas-admin .btn-close { filter: invert(1); }
</style>
{% endblock %}

{% block body %}
<!-- Mobile top bar -->
<nav class="navbar navbar-dark bg-dark mobile-topbar px-3 d-none">
    <button class="btn btn-outline-light btn-sm" type="button" data-bs-toggle="offcanvas" data-bs-target="#sidebarMobile">
        <i class="fas fa-bars"></i>
    </button>
    <span class="navbar-brand mb-0 ms-2">
        <i class="fas fa-dumbbell me-1 text-primary"></i>Admin
    </span>
    <span class="text-muted small">{{ now().strftime('%d/%m/%Y') }}</span>
</nav>

<!-- Mobile offcanvas sidebar -->
<div class="offcanvas offcanvas-start offcanvas-admin" tabindex="-1" id="sidebarMobile">
    <div class="offcanvas-header">
        <h5 class="text-white mb-0"><i class="fas fa-dumbbell me-2"></i>Academia</h5>
        <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
    </div>
    <div class="offcanvas-body p-0">
        {% include "admin/_sidebar_nav.html" %}
    </div>
</div>

<div class="d-flex">
    <!-- Desktop sidebar -->
    <nav class="sidebar sidebar-desktop d-flex flex-column p-3">
        <a href="{{ url_for('admin.dashboard') }}"
            class="d-flex align-items-center mb-3 text-white text-decoration-none">
            <i class="fas fa-dumbbell fa-2x me-2"></i>
            <span class="fs-5 fw-bold">Academia</span>
        </a>
        <hr class="border-secondary my-2">
        {% include "admin/_sidebar_nav.html" %}
    </nav>

    <!-- Main Content -->
    <main class="main-content flex-grow-1">
        <!-- Top Bar (desktop) -->
        <nav class="navbar navbar-light bg-white shadow-sm px-4 d-none d-lg-flex">
            <div class="container-fluid">
                <span class="navbar-text fw-medium">
                    {% block page_title %}Dashboard{% endblock %}
                </span>
                <span class="text-muted">
                    <i class="far fa-calendar me-1"></i>{{ now().strftime('%d/%m/%Y') }}
                </span>
            </div>
        </nav>

        <!-- Flash Messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
        <div class="px-3 px-lg-4 pt-3">
            {% for category, message in messages %}
            <div class="alert alert-{{ 'danger' if category == 'error' else category }} alert-dismissible fade show"
                role="alert">
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
            {% endfor %}
        </div>
        {% endif %}
        {% endwith %}

        <!-- Page Content -->
        <div class="p-3 p-lg-4">
            {% block content %}{% endblock %}
        </div>
    </main>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Auto-hide alerts after 5 seconds
    setTimeout(function () {
        document.querySelectorAll('.alert').forEach(function (alert) {
            new bootstrap.Alert(alert).close();
        });
    }, 5000);

    // Loading spinner em botoes de submit
    document.querySelectorAll('form').forEach(function (form) {
        form.addEventListener('submit', function () {
            var btn = form.querySelector('button[type="submit"]');
            if (btn && !btn.disabled) {
                btn.disabled = true;
                var originalHtml = btn.innerHTML;
                btn.innerHTML = '<span class="spinner-border spinner-border-sm me-1"></span>Aguarde...';
                setTimeout(function () {
                    btn.disabled = false;
                    btn.innerHTML = originalHtml;
                }, 8000);
            }
        });
    });

    // Fechar offcanvas ao clicar em link
    var offcanvasEl = document.getElementById('sidebarMobile');
    if (offcanvasEl) {
        offcanvasEl.querySelectorAll('.nav-link').forEach(function (link) {
            link.addEventListener('click', function () {
                var offcanvas = bootstrap.Offcanvas.getInstance(offcanvasEl);
                if (offcanvas) offcanvas.hide();
            });
        });
    }
</script>
{% endblock %}
