{% extends "base.html" %}

{% block title %}Meu Perfil{% endblock %}

{% block content %}
<div class="container py-4">
    <div class="row justify-content-center">
        <div class="col-md-8 col-lg-6">
            <div class="card shadow-sm border-0">
                <div class="card-header bg-white border-bottom">
                    <h5 class="mb-0 text-primary"><i class="fas fa-user-edit me-2"></i>Meu Perfil</h5>
                </div>
                <div class="card-body p-4">
                    {% if not current_user.cpf or not current_user.gender %}
                    <div class="alert alert-warning mb-4">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        Por favor, complete seu cadastro para desbloquear agendamentos.
                    </div>
                    {% endif %}

                    <form method="POST">
                        <div class="mb-3">
                            <label class="form-label fw-bold small text-uppercase text-muted">Nome Completo</label>
                            <input type="text" name="name" class="form-control" value="{{ current_user.name }}"
                                required>
                        </div>

                        <div class="mb-3">
                            <label class="form-label fw-bold small text-uppercase text-muted">Telefone
                                (WhatsApp)</label>
                            <input type="tel" name="phone" id="phone" class="form-control"
                                value="{{ current_user.phone }}" required>
                            <div class="form-text">Usado para lembretes de aula.</div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label fw-bold small text-uppercase text-muted">CPF</label>
                            <input type="text" name="cpf" id="cpf" class="form-control"
                                value="{{ current_user.cpf or '' }}" required maxlength="14"
                                placeholder="000.000.000-00">
                            {% if not current_user.cpf %}
                            <div class="text-danger small mt-1">
                                <i class="fas fa-exclamation-circle me-1"></i> Obrigatório para identificação e
                                pagamentos.
                            </div>
                            {% endif %}
                        </div>

                        <div class="mb-3">
                            <label class="form-label fw-bold small text-uppercase text-muted">Sexo Bilógico</label>
                            <div class="d-flex gap-3 p-3 border rounded bg-light">
                                <div class="form-check">
                                    <input type="radio" name="gender" value="female" class="form-check-input"
                                        id="genderFemale" {% if current_user.gender and
                                        current_user.gender.name=='FEMALE' %}checked{% endif %} required>
                                    <label class="form-check-label" for="genderFemale">
                                        <i class="fas fa-venus text-danger me-1"></i> Feminino
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input type="radio" name="gender" value="male" class="form-check-input"
                                        id="genderMale" {% if current_user.gender and current_user.gender.name=='MALE'
                                        %}checked{% endif %} required>
                                    <label class="form-check-label" for="genderMale">
                                        <i class="fas fa-mars text-primary me-1"></i> Masculino
                                    </label>
                                </div>
                            </div>
                            <div class="form-text small">Necessário para modalidades com segregação de público (ex:
                                horários exclusivos).</div>
                            {% if not current_user.gender %}
                            <div class="text-danger small mt-1">
                                <i class="fas fa-exclamation-circle me-1"></i> Seleção obrigatória.
                            </div>
                            {% endif %}
                        </div>

                        <div class="d-grid mt-4">
                            <button type="submit" class="btn btn-primary py-2 fw-bold">
                                <i class="fas fa-save me-1"></i> SALVAR ALTERAÇÕES
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function () {
        // CPF Mask Logic (Simple)
        const cpfInput = document.getElementById('cpf');
        if (cpfInput) {
            cpfInput.addEventListener('input', function (e) {
                let value = e.target.value.replace(/\D/g, '');
                if (value.length > 11) value = value.slice(0, 11);
                if (value.length > 9) value = value.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/, "$1.$2.$3-$4");
                else if (value.length > 6) value = value.replace(/(\d{3})(\d{3})(\d{1,3})/, "$1.$2.$3");
                else if (value.length > 3) value = value.replace(/(\d{3})(\d{1,3})/, "$1.$2");
                e.target.value = value;
            });
        }
    });
</script>
{% endblock %}