{% extends "base.html" %}

{% block title %}Questionﾃ｡rio de Saﾃｺde (PAR-Q){% endblock %}

{% block extra_css %}
<style>
    .parq-container {
        max-width: 600px;
        margin: 2rem auto;
        padding: 1rem;
        background: rgba(255, 255, 255, 0.9);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .question-card {
        display: none;
        animation: slideIn 0.4s cubic-bezier(0.165, 0.84, 0.44, 1);
    }

    .question-card.active {
        display: block;
    }

    .btn-answer {
        width: 100%;
        padding: 1.2rem;
        font-size: 1.15rem;
        font-weight: 600;
        margin-bottom: 1rem;
        border-radius: 12px;
        transition: all 0.3s ease;
        border: 2px solid transparent;
    }

    .btn-answer:hover {
        transform: translateY(-3px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }

    .btn-answer:active {
        transform: scale(0.97);
    }

    .btn-outline-success:hover {
        background-color: #28a745;
        border-color: #28a745;
        color: white;
    }

    .btn-outline-danger:hover {
        background-color: #dc3545;
        border-color: #dc3545;
        color: white;
    }

    .progress {
        height: 6px;
        border-radius: 10px;
        margin-bottom: 2.5rem;
        background-color: #e9ecef;
        overflow: hidden;
    }

    .progress-bar {
        transition: width 0.6s cubic-bezier(0.65, 0, 0.35, 1);
    }

    @keyframes slideIn {
        from {
            opacity: 0;
            transform: translateX(30px);
        }

        to {
            opacity: 1;
            transform: translateX(0);
        }
    }

    .icon-box {
        font-size: 3.5rem;
        background: linear-gradient(135deg, var(--primary-color), #4dabf7);
        -webkit-background-clip: text;
        background-clip: text;
        -webkit-text-fill-color: transparent;
        margin-bottom: 1rem;
    }
</style>
{% endblock %}

{% block content %}
<main class="container">
    <div class="parq-container card shadow-sm border-0">
        <div class="card-body">
            <div class="text-center mb-4">
                <div class="icon-box">
                    <i class="fas fa-heartbeat"></i>
                </div>
                <h2 class="fw-bold">Questionﾃ｡rio de Saﾃｺde</h2>
                <p class="text-muted">Leva apenas 1 minuto. Responda com sinceridade por sua seguranﾃｧa. 沽</p>
            </div>

            <div class="progress">
                <div id="parq-progress" class="progress-bar bg-primary" role="progressbar" style="width: 14%;"
                    aria-valuenow="14" aria-valuemin="0" aria-valuemax="100"></div>
            </div>

            <form id="parq-form" action="{{ url_for('health.submit_parq') }}" method="POST">
                {% if next_url %}
                <input type="hidden" name="next" value="{{ next_url }}">
                {% endif %}
                <!-- Pergunta 1 -->
                <div class="question-card active" data-step="1">
                    <h4 class="mb-4">1. Algum mﾃｩdico jﾃ｡ disse que vocﾃｪ possui algum problema de coraﾃｧﾃ｣o e recomendou que
                        sﾃｳ fizesse atividade fﾃｭsica sob prescriﾃｧﾃ｣o mﾃｩdica?</h4>
                    <button type="button" class="btn btn-outline-danger btn-answer"
                        onclick="setAnswer(1, 'sim')">SIM</button>
                    <button type="button" class="btn btn-outline-success btn-answer"
                        onclick="setAnswer(1, 'nao')">Nﾃグ</button>
                    <input type="hidden" name="q1" id="q1">
                </div>

                <!-- Pergunta 2 -->
                <div class="question-card" data-step="2">
                    <h4 class="mb-4">2. Vocﾃｪ sente dores no peito quando pratica atividade fﾃｭsica?</h4>
                    <button type="button" class="btn btn-outline-danger btn-answer"
                        onclick="setAnswer(2, 'sim')">SIM</button>
                    <button type="button" class="btn btn-outline-success btn-answer"
                        onclick="setAnswer(2, 'nao')">Nﾃグ</button>
                    <input type="hidden" name="q2" id="q2">
                </div>

                <!-- Pergunta 3 -->
                <div class="question-card" data-step="3">
                    <h4 class="mb-4">3. No ﾃｺltimo mﾃｪs, vocﾃｪ sentiu dores no peito quando nﾃ｣o estava praticando atividade
                        fﾃｭsica?</h4>
                    <button type="button" class="btn btn-outline-danger btn-answer"
                        onclick="setAnswer(3, 'sim')">SIM</button>
                    <button type="button" class="btn btn-outline-success btn-answer"
                        onclick="setAnswer(3, 'nao')">Nﾃグ</button>
                    <input type="hidden" name="q3" id="q3">
                </div>

                <!-- Pergunta 4 -->
                <div class="question-card" data-step="4">
                    <h4 class="mb-4">4. Vocﾃｪ perde o equilﾃｭbrio em razﾃ｣o de tonturas ou jﾃ｡ perdeu a consciﾃｪncia?</h4>
                    <button type="button" class="btn btn-outline-danger btn-answer"
                        onclick="setAnswer(4, 'sim')">SIM</button>
                    <button type="button" class="btn btn-outline-success btn-answer"
                        onclick="setAnswer(4, 'nao')">Nﾃグ</button>
                    <input type="hidden" name="q4" id="q4">
                </div>

                <!-- Pergunta 5 -->
                <div class="question-card" data-step="5">
                    <h4 class="mb-4">5. Vocﾃｪ tem algum problema ﾃｳsseo ou articular que poderia ser piorado pela
                        atividade fﾃｭsica?</h4>
                    <button type="button" class="btn btn-outline-danger btn-answer"
                        onclick="setAnswer(5, 'sim')">SIM</button>
                    <button type="button" class="btn btn-outline-success btn-answer"
                        onclick="setAnswer(5, 'nao')">Nﾃグ</button>
                    <input type="hidden" name="q5" id="q5">
                </div>

                <!-- Pergunta 6 -->
                <div class="question-card" data-step="6">
                    <h4 class="mb-4">6. Estﾃ｡ tomando atualmente algum medicamento para pressﾃ｣o arterial ou problema
                        cardﾃｭaco?</h4>
                    <button type="button" class="btn btn-outline-danger btn-answer"
                        onclick="setAnswer(6, 'sim')">SIM</button>
                    <button type="button" class="btn btn-outline-success btn-answer"
                        onclick="setAnswer(6, 'nao')">Nﾃグ</button>
                    <input type="hidden" name="q6" id="q6">
                </div>

                <!-- Pergunta 7 -->
                <div class="question-card" data-step="7">
                    <h4 class="mb-4">7. Sabe de alguma outra razﾃ｣o pela qual nﾃ｣o deveria fazer atividade fﾃｭsica?</h4>
                    <button type="button" class="btn btn-outline-danger btn-answer"
                        onclick="setAnswer(7, 'sim')">SIM</button>
                    <button type="button" class="btn btn-outline-success btn-answer"
                        onclick="setAnswer(7, 'nao')">Nﾃグ</button>
                    <input type="hidden" name="q7" id="q7">
                </div>

                <!-- Termo de Responsabilidade (Step Final) -->
                <div class="question-card" data-step="8">
                    <div class="text-start mb-4 p-3 bg-light rounded shadow-sm"
                        style="font-size: 0.9rem; line-height: 1.6;">
                        <h5 class="fw-bold mb-3"><i class="fas fa-file-contract me-2"></i>TERMO DE RESPONSABILIDADE</h5>
                        <p>Olﾃ｡! Antes de comeﾃｧarmos sua jornada fitness, precisamos que vocﾃｪ leia e concorde com alguns
                            pontos importantes. 沽</p>
                        <p>Eu, <strong>{{ current_user.name }}</strong>, CPF <strong>{{ current_user.cpf or 'Nﾃ｣o
                                informado' }}</strong>, declaro que:</p>
                        <ul class="list-unstyled">
                            <li><i class="fas fa-check-circle text-success me-2"></i><strong>Veracidade:</strong>
                                Confirmei que minhas respostas acima sﾃ｣o verdadeiras.</li>
                            <li><i class="fas fa-check-circle text-success me-2"></i><strong>Conheﾃｧo os Riscos:</strong>
                                Entendo que exercﾃｭcios fﾃｭsicos envolvem riscos naturais, e assumo responsabilidade por
                                condiﾃｧﾃｵes de saﾃｺde nﾃ｣o informadas.</li>
                            <li><i class="fas fa-check-circle text-success me-2"></i><strong>Orientaﾃｧﾃ｣o Mﾃｩdica:</strong>
                                Se respondi "SIM" a qualquer pergunta, sei que devo consultar um mﾃｩdico antes de
                                comeﾃｧar.</li>
                            <li><i class="fas fa-check-circle text-success me-2"></i><strong>Privacidade:</strong>
                                Autorizo o uso dos meus dados de saﾃｺde apenas para gestﾃ｣o de seguranﾃｧa da academia.</li>
                        </ul>
                    </div>

                    <div class="form-check mb-4">
                        <input class="form-check-input" type="checkbox" id="agree-terms" required>
                        <label class="form-check-label fw-bold" for="agree-terms">
                            Li, entendi e concordo com tudo acima! 汳ｪ
                        </label>
                    </div>

                    <button type="submit" class="btn btn-primary w-100 py-3 fw-bold rounded-pill shadow">
                        CONFIRMAR E CONTINUAR <i class="fas fa-arrow-right ms-2"></i>
                    </button>
                </div>
            </form>

            <div class="mt-4 text-center">
                <button id="prev-btn" class="btn btn-link text-muted" style="display: none;" onclick="prevStep()">
                    <i class="fas fa-chevron-left me-1"></i> Voltar
                </button>
            </div>
        </div>
    </div>
</main>
{% endblock %}

{% block extra_js %}
<script>
    let currentStep = 1;
    const totalSteps = 8;
    const progress = document.getElementById('parq-progress');
    const form = document.getElementById('parq-form');
    const prevBtn = document.getElementById('prev-btn');

    function setAnswer(step, answer) {
        document.getElementById(`q${step}`).value = answer;
        nextStep();
    }

    function nextStep() {
        if (currentStep < totalSteps) {
            document.querySelector(`[data-step="${currentStep}"]`).classList.remove('active');
            currentStep++;
            document.querySelector(`[data-step="${currentStep}"]`).classList.add('active');
            updateProgress();

            if (currentStep > 1) {
                prevBtn.style.display = 'inline-block';
            }
        }
    }

    function prevStep() {
        if (currentStep > 1) {
            document.querySelector(`[data-step="${currentStep}"]`).classList.remove('active');
            currentStep--;
            document.querySelector(`[data-step="${currentStep}"]`).classList.add('active');
            updateProgress();

            if (currentStep === 1) {
                prevBtn.style.display = 'none';
            }
        }
    }

    function updateProgress() {
        const percent = (currentStep / totalSteps) * 100;
        progress.style.width = `${percent}%`;
        progress.setAttribute('aria-valuenow', percent);
    }
</script>
{% endblock %}